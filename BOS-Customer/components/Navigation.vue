<template>
  <section>
    <div
      v-if="$route.path !== '/'"
      class="w-full fixed bottom-0 left-0 bg-white shadow-[inset_0_2px_2px_rgba(0,0,0,0.2)]"
    >
      <div
        class="w-[76px] h-[76px] absolute left-1/2 -translate-x-1/2 bottom-3 rounded-full overflow-hidden"
      >
        <button
          ref="book"
          @click="$router.push('/member/appointment')"
          data-mdb-ripple="true"
          data-mdb-ripple-color="light"
          class="w-full h-full text-white text-sm bg-[#232D4E]"
        >
          <p v-pre>立即</p>
          <p v-pre>預約</p>
        </button>
      </div>
      <ul class="flex">
        <li
          class="text-center w-[20%]"
          v-for="(item, i) in menuList"
          :key="i"
          :class="{ 'ml-auto': i === 2, hidden: i > 3 }"
        >
          <button
            @click="item.label === '登出' ? logOut() : $router.push(item.path)"
            data-mdb-ripple="true"
            data-mdb-ripple-color="dark"
            class="py-3 w-full"
          >
            <fa :icon="item.icon" class="text-xl" />
            <p class="text-sm">{{ item.label }}</p>
          </button>
        </li>
      </ul>
    </div>
  </section>
</template>

<script>
import { removeToken } from "@/plugins/cookies";
export default {
  name: "Navigation",
  data() {
    return {
      menuList: [
        { label: "首頁", path: "/member", icon: "fa-regular fa-house" },
        {
          label: "服務紀錄",
          path: "/member/consumption",
          icon: "fa-regular fa-sack-dollar",
        },
        {
          label: "我的卡券",
          path: "/member/ticket",
          icon: "fa-regular fa-ticket",
        },
        {
          label: "入金紀錄",
          path: "/member/addValue",
          icon: "fa-regular fa-circle-dollar",
        },
        { label: "會員資料", path: "/member/info", icon: "fa-regular fa-user" },
        {
          label: "偏好設定",
          path: "/member/setting",
          icon: "fa-regular fa-heart",
        },
        { label: "登出", icon: "fa-regular fa-arrow-right-from-bracket" },
      ],
      bakmenuList: [
        { label: "首頁", path: "/member", icon: "fa-regular fa-house" },
        {
          label: "服務紀錄",
          path: "/member/consumption",
          icon: "fa-regular fa-sack-dollar",
        },
        {
          label: "我的卡券",
          path: "/member/ticket",
          icon: "fa-regular fa-ticket",
        },
        {
          label: "入金紀錄",
          path: "/member/addValue",
          icon: "fa-regular fa-circle-dollar",
        },
        {
          label: "紅利點數",
          path: "/member/customerBonus",
          icon: "fa-regular fa-circle-p",
        },
        { label: "會員資料", path: "/member/info", icon: "fa-regular fa-user" },
        {
          label: "偏好設定",
          path: "/member/setting",
          icon: "fa-regular fa-heart",
        },
        { label: "登出", icon: "fa-regular fa-arrow-right-from-bracket" },
      ],
      merchantId: "",
      isDisplay: {},
    };
  },
  methods: {
    showAlert() {
      this.$swal.fire({
        icon: "warning",
        title: `<h3 class="text-2xl">功能尚未開放<br>Coming Soon</h3>`,
        background: "#fff",
        iconColor: "#FEB401",
        timer: 1500,
        showConfirmButton: false,
      });
    },
    handleDisplay(newValue) {
      this.isDisplay = newValue;
      this.menuList = this.bakmenuList;
      let hideList = [];
      let needHandleDisplayList = new Map([
        ["ServiceRecord", "服務紀錄"],
        ["TicketRecord", "我的卡券"],
        ["WalletRecord", "入金紀錄"],
        ["BonusRecord", "紅利點數"],
      ]);

      needHandleDisplayList.forEach((value, key) => {
        if (!this.isDisplay[key]) hideList.push(value);
      });
      this.menuList = this.menuList.filter(
        (item) => !hideList.includes(item.label)
      );
    },
    logOut() {
      this.$swal
        .fire({
          html: `<p class="text-lg text-[#232D4E] font-bold">確定要登出嗎?</p>`,
          showCancelButton: true,
          confirmButtonText: "登出",
          confirmButtonColor: "#232D4E",
          cancelButtonText: "取消",
        })
        .then((result) => {
          if (result.isConfirmed) {
            removeToken();
            window.localStorage.clear();
            this.$swal
              .fire({
                icon: "success",
                title: '<h3 class="text-2xl">會員已登出</h3>',
                background: "#fff",
                iconColor: "#FEB401",
                timer: 1500,
                showConfirmButton: false,
              })
              .then(() => {
                // this.$cookieMethods.removeToken()
                this.$router.push("/");
                setTimeout(() => {
                  location.reload();
                }, 100);
              });
          }
        });
    },
  },
  watch: {
    "$store.state.customerSidePageDisplay.isDisplay"(newValue) {
      this.handleDisplay(newValue);
    },
    async $route() {
      const merchant = JSON.parse(localStorage.getItem("merchant"));
      this.merchantId = merchant ? JSON.stringify(merchant?.id) : "";
      if (
        this.$router.currentRoute.path.includes("/appointment/selectDate") ||
        this.$router.currentRoute.path.includes(
          "/member/appointment/selectService"
        )
      ) {
        this.$refs.book?.classList.add("!bg-[#aeaeae]");
        this.$refs.book?.setAttribute("disabled", true);
      } else {
        this.$refs.book?.classList.remove("!bg-[#aeaeae]");
        this.$refs.book?.removeAttribute("disabled");
      }
    },
  },
};
</script>
